<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- <meta name="google-signin-client_id" content="1070723419509-ig3u8aapsfjn9ge421rervobr8409qtf.apps.googleusercontent.com"> -->

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

    <link rel="stylesheet" href="/css/index.css">
    <title>외식코기</title>
</head>

<body>
    <div class="card">
        <div id="main" class="card-body">
            <img class="title" src="/images/title.png" alt="title">
            <input class="form-control email" type="text" placeholder="아이디 (이메일)">
            <input class="form-control password" type="password" placeholder="비밀번호">
            <button class="login-btn" id="login-btn">로그인</button>
            <div class="help">
                <button class= 'help-btn1' id="find-info" data-toggle="modal" data-target="#find-pw">아이디/비밀번호 찾기</button>
                <button class= 'help-btn2' id="login-onetime" data-toggle="modal" data-target="#exampleModal">로그인없이 이용하기</button>
            </div>
            <!-- <div class="social-login">
                <div class="naver-login" id="naverIdLogin"></div>
                <img class="naver-login" src="/images/naver.png" alt="naver-login">
                <img class="google-login" src="/images/google.png" alt="google-login">
            </div> -->


            <div class="modal fade bd-example-modal-sm" id="find-pw" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">비밀번호 재발급</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        </div>
                        <div class="modal-body">
                            <p>가입하신 이메일 주소를 입력해주세요.</p>
                            <input class="form-control" type="email" id="signedup-email" placeholder="가입한 이메일">
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="reissue-pw">임시 비밀번호 발급</button>
                        </div>
                    </div>
                </div>
            </div>

              <div class="signup">
                    <!-- <a href="/signup"> -->
                    <a href="#">
                    <img class="signup-deco" src="/images/signup-deco.png" alt="signup">
                    <span class="signup-btn" id="signup-btn">20초만에 회원가입하기</span>
                    </a>
              </div>
            <!-- <img src="/images/poodle.png" alt="" style="width: 90%;">

            <div id="naverIdLogin" style="margin-bottom:10px;"></div>
            <img class="google-login" src="/images/google2.png" alt="" style="margin-bottom: 10px;">

            <div class="g-signin2 google" data-onsuccess="onSignIn" style="display:none;"></div>

            <p class="by-email">
                <a class="login" href="/login">이메일로 로그인</a>
                &nbsp;&nbsp;|&nbsp;&nbsp;
                <a class="signup" href="/signup">이메일로 회원가입</a>
            </p> -->

            <!-- Button trigger modal -->

            <!-- Modal -->
            <div class="modal fade bd-example-modal-sm" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">로그인없이 이용하기</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    비로그인 사용자분들에게는 예약 및 맛집리스트 생성기능 등이 제한됩니다.
                  </div>
                  <div class="modal-footer">
                    <!-- <button type="button" id="unsigned" class="btn btn-secondary" onclick="location.href='/chat_unsigned'">그냥 이용하기</button> -->
                    <button type="button" id="unsigned" class="btn btn-secondary">그냥 이용하기</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">로그인하기</button>
                  </div>
                </div>
              </div>
            </div>

        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <!-- Naver Login -->
    <!-- <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js" charset="utf-8"></script> -->
    <!-- Google Login -->
    <!-- <script src="https://apis.google.com/js/platform.js" async defer></script> -->
    <!-- Custom JS -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/base.js"></script>
    <script src="/js/index.js"></script>

    <script type="text/javascript">

    $(document).ready(function(){
    // var isIE = /*@cc_on!@*/false || !!document.documentMode;
    // var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || safari.pushNotification) || !!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);
    // console.log(isIE);
    // console.log(isSafari);

    // if(isIE || isSafari) {
      // alert('현재 사파리, Explorer 브라우저에서는 이용이 불가합니다.');
    // }
    // else {
     // alert('Chrome');
     // window.location.replace('/error');
       // 네이버 로그인 설정
     //   let naverLogin = new naver.LoginWithNaverId(
     // 	{
     // 		clientId: "DnnpK9bi2MdliAiFZZUQ",
     //           // callbackUrl: "http://localhost:8001/",
     //           callbackUrl: location.href,
     //           callbackHandle: true,
     // 		isPopup: false, /* 팝업을 통한 연동처리 여부 */
     // 		loginButton: {color: "green", type: 3, height: 70} /* 로그인 버튼의 타입을 지정 */
     // 	}
     //   );
     // /* 설정정보를 초기화하고 연동을 준비 */
     //   naverLogin.init();
     //   $('#naverIdLogin_loginButton img')[0].src = '/images/naver.png';
       var loginValue = sessionStorage.getItem('login');
       // let emailValue = sessionStorage.getItem('email');
       // console.log(`LoginValue : ${loginValue}, emailValue : ${emailValue}`);
       // console.log("loginValue: "+loginValue)
       if (loginValue === '0' || loginValue === null) {
           const info = {
               url: '/api/v1/users/verify_token',
               method: 'POST',
               data: null,
               crossDomain: true,
               redirect: 'follow',
               xhrFields: {
                   withCredentials: true
               },
               success: function (res) {
                   if (res.success) {
                       console.log(res);
                       console.log('verifyToken success');
                       //추가
                       sessionStorage.setItem('login', '0');
                       sessionStorage.setItem('email', res.email);
                       window.location.replace(res.redirect);
                   } else {
                       console.log('verifyToken fail');
                       console.log(res);
                   }
               },
               error: function (e) {
                   console.log('ajax call error: login page - verifyToken');
                   if (e.status === 404 && e.responseText.includes("API call URL not found.")) {
                       console.log("check your URL, method(GET/POST)");
                   }else if(e.status === 403){
                       if (e.responseText.includes("No token provided."))
                           console.log("No token, no problem.");
                       else if (e.responseText.includes("jwt malformed"))
                           console.log("Malformed token");
                       else if (e.responseText.includes("invalid signature"))
                           console.log("Modified token");
                       else console.log(e);
                   } else if(e.status === 0){
                       if(navigator.onLine){
                           console.log('status : 0');
                       }else {
                           console.log('internet disconnected');
                           window.location.reload();
                       }
                   } else{
                       console.log('status: ' + e.status + ', message: ' + e.responseText);
                       console.log(e);
                   }
               }
           }
           sendTokenReq(info);
       } else if (loginValue === '-1'){
         console.log("비회원 로그인");
       }
       else {
           location.href='/lobby';
       }

       // window.addEventListener('load', () => {
       //     naverLogin.getLoginStatus((status) => {
       //         if (status) {
       //           let email = naverLogin.user.getEmail();
       //           let name = naverLogin.user.getName();
       //           let nickname = naverLogin.user.getNickName();
       //           let birthday = naverLogin.user.getBirthday();
       //           let age = naverLogin.user.getAge();
       //           console.log(birthday);
       //           const info = {
       //             url: '/api/v1/users/social_login',
       //             method: 'POST',
       //             body: {
       //                 email: email,
       //                 name: name,
       //                 token: naverLogin.accessToken.accessToken
       //             },
       //             success: function (res) {
       //                 if (res.success) {
       //                     sessionStorage.setItem('login', '1');
       //                     sessionStorage.setItem('email', email);
       //                     window.location.replace(res.redirect)
       //                 } else {
       //                     console.log(res);
       //                 }
       //             },
       //             error: function (e) {
       //                 console.log(e.responseJSON);
       //                 if (e.responseJSON.message === 'This email is Already signed up.') {
       //                     window.location.replace(res.redirect)
       //                     localStorage.clear();
       //                     sessionStorage.clear();
       //                     alert('이미 가입된 이메일입니다.');
       //                 } else {
       //                     alert('접근 불가능합니다.');
       //                 }
       //             }
       //           }
       //           sendTokenReq(info);
       //         }
       //     });
       //
       // })
       //
       // // 네이버 로그인 버튼 클릭
       // $('#naverIdLogin').click(() => {
       // })
       //
       // // 구글 로그인 버튼 클릭
       // $('.google-login').click(() => {
       //     $('.abcRioButton').trigger('click');
       // });

       $('input[type=text]').on('keydown', function(e) {
           if (e.which == 13) {
               loginValidationCheck();
           }
       });

       $('input[type=password]').on('keydown', function(e) {
           if (e.which == 13) {
               loginValidationCheck();
           }
       });

       // 회원가입 버튼 클릭
       $('.signup-btn').click(function(){
         console.log('clicked');
         window.location.replace('/signup');
       })

       // 로그인 버튼 클릭
       $('#login-btn').click(function(){
         loginValidationCheck();
       })

       // 임시 비번 발급 클릭
       $('#reissue-pw').click(function(){
         reIssueValidationCheck();
       })

       $('#unsigned').click(function(){
         console.log('unsigned access detected');
         email=String(Date.now())+'@jellylab.io';
         name='비회원';
         password=String(Date.now());
         const info = {
             method: "POST",
             url: '/api/v1/users/register_onetime_user',
             body: {
               email: email,
               name: name,
               password: password,
             },
             success: function (res) {
                 if (res.success){
                     console.log("signUpReq: success!");
                     loginOnetime();
                 }else {
                     console.log("signUpReq: fail!");
                     console.log(res);
                 }
             },
             error: function(e) {
                 console.log('ajax call error: signup page - singUpReq');
                 if (e.status === 404 && e.responseText.includes("API call URL not found."))
                     console.log("check your URL, method(GET/POST)");
                 else if ((e.status === 400 && e.responseText.includes("not provided"))
                     || (e.status === 500 && e.responseText.includes("Cannot read property"))) {
                     console.log("check your parameters");
                 } else if(e.status === 0){
                     if(navigator.onLine){
                         console.log('status : 0');
                     }else {
                         console.log('internet disconnected');
                         window.location.reload();
                     }
                 } else {
                     console.log('status: ' + e.status + ', message: ' + e.responseText);
                 }
                 alert("정보 업데이트가 실패했습니다.");
             }
         };
         sendReq(info);
       })
   // }
    // var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);
    // alert(isChrome)
    // if(!isChrome) {
      // alert('현재 크롬 브라우저에서만 이용 가능합니다');
    // }
    })
    </script>

</body>
</html>
